# ===============================================================================
# Z. ДИСКЛЕЙМЕР
# ===============================================================================

label disclaimer:
    scene black with fade
    
    # Текст дисклеймера, оформленный как "просто текст" (d_text) для NVL режима.
    d_text "Этот проект является художественной визуальной новеллой, основанной на исторических событиях операции «Багратион» в 1944 году."
    d_text "Он не преследует целей пропаганды, а ставит своей задачей честное и реалистичное отображение суровых условий и моральных дилемм войны."
    d_text "Все персонажи и их поступки являются вымышленными. Игра содержит сцены насилия и трагические моменты."
    
    # Меню выбора: хочу продолжить или нет
    menu:
        "Хочу продолжить игру":
            nvl hide
            nvl clear
            pass # Продолжить выполнение кода после меню
        
        "Не хочу продолжать (Выход из игры)":
            nvl hide
            nvl clear
            # Используем команду для немедленного выхода из игры
            $ renpy.full_quit()     
    return

# ===============================================================================
# A. НАСТРОЙКА ИГРОВЫХ ПЕРЕМЕННЫХ
# ===============================================================================

# Звуковые эффекты
define artillery = "audio/artillery.mp3"
define rain = "audio/rain.mp3"
define machine_gun = "audio/machine_gun.mp3"
define birds_morning = "audio/birds_morning.mp3"
define theme_calm = "audio/theme_calm.mp3"
define incoming_shell_rising = "audio/incoming_shell_rising.mp3"
define explosion_loud = "audio/explosion_loud.mp3"
define theme_tense = "audio/theme_tense.mp3"

# ===============================================================================
# B. ОПРЕДЕЛЕНИЕ ПЕРСОНАЖЕЙ
# ===============================================================================

define n_narr = Character("Безымянный", color="#91d46a", kind=nvl)
define narr = Character("Безымянный", color="#91d46a")
# Новый персонаж для вывода дисклеймера
define d_text = Character("Автор",color="#ffffff", kind=nvl) 
# Новый псевдоним для нейтрального, невидимого повествования ("Удар!")
define scene_narr = Character(None,)

define ivan = Character("Иван", color="#b0e0e6")
define kolya = Character("Коля", color="#add8e6")
define politruk = Character("Политрук", color="#ff7f7f")
define masha = Character("Маша", color="#98fb98")
define soldier = Character("Рядовой", color="#ffffff")


# ===============================================================================
# C. ПРЕДЫСТОРИЯ (СОН И ПРОБУЖДЕНИЕ)
# ===============================================================================

label pre_history:
    # --- СЦЕНА 1: СОН (ДОМ) ---
    scene black with fade
    play music theme_calm fadein 2.0
    # scene bg bedroom_morning with fade 
    
    n_narr "Утренний свет. Я помню только этот свет. И запах свежего хлеба, который давно не чувствовал."
    n_narr "Я помню обещание, которое дал ей. Вернуться. Несмотря ни на что."
    n_narr "Она ждет."
    
    nvl hide
    nvl clear

    # --- ПЕРЕХОД: ГУЛ ВО СНЕ ---
    stop music fadeout 3.0
    
    n_narr "Но этот сон... он начинает дрожать."

    nvl hide
    nvl clear
    
    scene black with dissolve
    play sound incoming_shell_rising fadein 2.0 loop
    
    n_narr "Я слышу его сквозь сон. Этот до чёрта знакомый гул. Низкий. Нарастающий. Он всё ближе."

    nvl hide
    nvl clear
    
    # --- КУЛЬМИНАЦИЯ: ВЗРЫВ И ПРОБУЖДЕНИЕ ---
    stop sound # Останавливаем гул
    play sound explosion_loud # РЕЗКИЙ ВЗРЫВ
    scene black with hpunch
    
    # scene bg trench_night with fade 
    
    # Переход к основной сцене "Берег"
    play music theme_tense fadein 1.0
    play sound rain loop
    
    scene_narr "Удар!" 
    
    n_narr "Глаза открываются рывком. В рот набилась земля. Чёрт..."

    nvl hide
    nvl clear
    
    return

# ===============================================================================
# D. ОСНОВНАЯ ТОЧКА ВХОДА В ИГРУ (НОВЫЙ СЮЖЕТ БЕЗ ВЫБОРА УБЕЖИЩА И КОДЕКСА)
# ===============================================================================

label start:
    call disclaimer # Вызов дисклеймера
    call pre_history # Вызов нашей предыстории
    
    # Пролог: Ночь на 28-29 июня. «Берег»
    # scene bg trench_night with fade # Локация: Восточный берег реки (Продолжение после взрыва)

    narr "Ночь на 28 июня. Восточный берег реки Березина. Если переживу, отмечу это."

    # СЦЕНА 1: ОЖИДАНИЕ (The Huddle)
    n_narr "Тяжёлые капли дождя барабанят по каске. Вдалеке слышен приглушённый гул артиллерии и стук пулеметов."
    n_narr "Отряд сидит в укрытии, прижавшись к мокрой земле."

    nvl hide
    nvl clear

    ivan "Всем внимание. До сигнала меньше часа. Проверить снаряжение, подогнать ремни. Отдыхаем, пока можем."

    kolya "Т-товарищ старшина... я..." with hpunch
    n_narr "Коля, молодой боец, заметно нервничает, его дыхание сбивается."

    nvl hide
    nvl clear

    ivan "Спокойно, боец. Первый раз всегда страшно. Держись рядом."

    # СЦЕНА 2: ОСТОРОЖНОСТЬ (Прямое действие, как в оригинальном коде)
    n_narr "Коля, молодой боец, дрожит. Он сидит в невыгодной воронке. Слишком заметен, надо ему помочь будто нам потерь еще не хватало."
    n_narr "Аккуратно подойдя к Коле и положив руку на его плечо, я шепчу:"

    nvl hide
    nvl clear
    
    narr "возьми позицию правее меня, эта воронка лучше укроет." 
    kolya "П-понял... спасибо, товарищ..."

    # СЦЕНА 3: ФОРСИРОВАНИЕ (The Chaos)
    n_narr "Внезапно небо озаряется яркими вспышками. Начинается артподготовка."
    n_narr "Первые лодки уже спускают на воду. Холодные брызги летят в лицо."

    nvl hide
    nvl clear

    ivan "Вперёд! За мной! Держать строй!"
    
    # КЛЮЧЕВОЙ ВЫБОР ПРОЛОГА: СЛЕДОВАТЬ ПРИКАЗУ (Остался только выбор Обоза)
    n_narr "Сигнал. Начинается хаос. Мы бросаемся в ледяную воду."
    
    # scene bg river_crossing
    play sound machine_gun # Звук пулемета
    
    n_narr "Вода холодная, дыхание перехватывает. Вокруг крики, свист пуль, взрывы мин, брызги."
    n_narr "Всё, что я могу сделать — это плыть. К западному берегу."

    nvl hide
    nvl clear
    
    # Итог: Закрепление
    stop music fadeout 2.0
    stop sound fadeout 2.0
    # scene bg western_bank with fade 
    play music theme_tense # Слегка менее напряженная музыка
    n_narr "Спустя казалось вечность, решив боевые задачи, мы выходим на плацдарм. Мокрые, уставшие, но живые."
    
    nvl hide
    nvl clear

    # ДЕНЬ 1: 29 ИЮНЯ. «ПРОРЫВ»
    scene black with dissolve
    # scene bg dusty_road_day with fade # Локация: Лесные дороги и поля
    
    n_narr "Утро сменило ночь. Мы совершаем стремительный марш. Жара и пыль поднимается столбом. Все тяжело дышат."

    nvl hide
    nvl clear

    # СЦЕНА 4: НА МАРШЕ (The Dust)
    politruk "Держать темп, товарищи! Каждая минута — это километры, отделяющие нас от фашистского зверя!"
    politruk "Именно наша скорость — ключ к успеху «Багратиона»! Нельзя дать им окопаться!"
    
    # СЦЕНА 5: КАВАЛЕРИЙСКАЯ ГРУППА (The Spearhead)
    # scene bg spearhead_view with dissolve # Кадр, где видно авангард

    n_narr "На главной дороге грохочут танки и несётся кавалерия."

    nvl hide
    nvl clear

    politruk "Вот они, товарищи! Авангард прорыва! Кавалерийско-механизированная группа Плиева!"
    politruk "Их дело — рвать оборону, наше — не отставать и зачищать фланги."

    # Сведения о Кодексе удалены.
    
    # СЦЕНА 6: НЕМЕЦКИЙ ОБОЗ (The Target) - Ключевой выбор
    # scene bg forest_ambush with dissolve # Лесная дорога, засада
    
    masha "Тихо! Сюда!"
    
    n_narr "Нас останавливает партизанка, Маша. Она указывает на лесную дорогу."

    nvl hide
    nvl clear

    masha "Там застрял немецкий обоз. Два грузовика, охрана — тыловики. Шанс взять припасы и главное — патроны."

    ivan "Это ловушка, Маша? Или...?"
    
    masha "Нет. Застряли в грязи. У них нет времени ждать."
    
    n_narr "Старшина смотрит на меня. Припасы нужны, но риск велик."

    nvl hide
    nvl clear
    
    menu choice_convoy:
        "Атаковать немедленно (Рискованно, но быстро)":
            narr "Нам нужны припасы. И быстро."
            ivan "Хорошо. Берём в кольцо. Атака!"
            jump convoy_fight
        
        "Сообщить командованию по рации (Безопасно, но потеря припасов)":
            narr "Риск неоправдан. Лучше передать информацию основным силам."
            politruk "Верное решение, боец. Разумная предосторожность."
            jump convoy_report

# --- ВЕТКИ ВЫБОРА ОБОЗА ---

label convoy_fight:
    scene black with fade
    play sound machine_gun
    n_narr "Начинается короткий, но ожесточенный бой. Немцы были застигнуты врасплох. Мы получили патроны и еду."
    nvl hide
    nvl clear
    jump end_of_day1

label convoy_report:
    n_narr "Передаём координаты обоза. Через полчаса слышим отдалённый взрыв. Скорее всего, немцы сами уничтожили обоз при отступлении, или его перехватили другие."
    n_narr "Мы остались с тем, что имели, но избежали потерь."
    nvl hide
    nvl clear
    jump end_of_day1
    
# --- ИТОГ ДНЯ 1 ---

label end_of_day1:
    scene black with fade
    n_narr "К вечеру мы выходим на подступы к городу."
    n_narr "Вдалеке слышны тяжелые бои — идет штурм."
    n_narr "Первый день прорыва закончен."
    nvl hide
    nvl clear
    return